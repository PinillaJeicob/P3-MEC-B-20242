package com.mycompany.eps;
import javax.swing.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;
import java.util.LinkedList;
import java.util.Queue;

public class EPS extends javax.swing.JFrame {
        private JLabel labelTiempo;  // Etiqueta para el cronómetro
        private Timer timer;  // Timer para actualizar el tiempo
        private LocalTime tiempoActual;
        private Queue<String> colaResultados;  // Cola para almacenar resultados
        private DefaultListModel<String> modeloEnProceso; // Modelo para mostrar resultados en proceso
        private JList<String> listaEnProceso; // JList para mostrar los elementos en proceso
        private JSlider sliderVelocidad; // Slider para ajustar la velocidad del cronómetro
    // Constructor
    public EPS() {
        initComponents();
        iniciarCronometro();  // Llamamos al cronómetro
        colaResultados = new LinkedList<>(); // Inicializamos la cola
        modeloEnProceso = new DefaultListModel<>(); // Inicializamos el modelo para la lista
        listaEnProceso = new JList<>(modeloEnProceso); // Crear la lista con el modelo
    }

    // Método para inicializar los componentes
    private void initComponents() {
        
        // Crear los elementos
        JLabel labelCedula = new JLabel("Ingrese Cédula:");
        JTextField fieldCedula = new JTextField(15);

        JLabel labelCategoria = new JLabel("Seleccione Categoría:");
        JComboBox<String> comboCategoria = new JComboBox<>(new String[]{"Menor de 10 años", "Joven", "Adulto Mayor","Persona con discapacidad"});

        JLabel labelServicio = new JLabel("Seleccione Servicio:");
        JComboBox<String> comboServicio = new JComboBox<>(new String[]{"Consulta médica General", "Consulta médica Especializada", "Prueba de laboratorio","imagenes (diagnosticos)"});

        JButton btnProcesar = new JButton("Procesar Atención");
        JButton btnIniciarProceso = new JButton("Iniciar Procesamiento");
        
        JTextArea areaResultado = new JTextArea(25, 40);
        areaResultado.setEditable(false);
        labelTiempo = new JLabel("Hora Actual: 00:00:00");  // Etiqueta para mostrar el cronómetro
        // Slider para ajustar la velocidad
        sliderVelocidad = new JSlider(1, 10); // Rango de 1 a 10 segundos
        sliderVelocidad.setMajorTickSpacing(1);
        sliderVelocidad.setPaintTicks(true);
        sliderVelocidad.setPaintLabels(true);
        sliderVelocidad.setValue(5); // Valor predeterminado (5 segundos)
        
        JLabel labelSlider = new JLabel("Velocidad de Procesamiento (segundos):");


// Configurar el layout
        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Simulación Atención EPS");

        // Layout usando GroupLayout
        GroupLayout layout = new GroupLayout(getContentPane());
        getContentPane().setLayout(layout);

        // Configuramos el layout en forma horizontal y vertical
        layout.setHorizontalGroup(
            layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(GroupLayout.Alignment.LEADING)
                    .addComponent(labelCedula)
                    .addComponent(labelCategoria)
                    .addComponent(labelServicio)
                    .addComponent(btnProcesar)
                    .addComponent(btnIniciarProceso)
                    .addComponent(labelSlider) // Etiqueta del slider
                    .addComponent(labelTiempo) 
                )
                .addGroup(layout.createParallelGroup(GroupLayout.Alignment.LEADING)
                    .addComponent(fieldCedula)
                    .addComponent(comboCategoria)
                    .addComponent(comboServicio)
                    .addComponent(areaResultado)
                        .addComponent(sliderVelocidad) // Añadimos el slider
                    .addComponent(new JScrollPane(listaEnProceso)) 
                )
        );

        layout.setVerticalGroup(
            layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(labelCedula)
                    .addComponent(fieldCedula)
                )
                .addGroup(layout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(labelCategoria)
                    .addComponent(comboCategoria)
                )
                .addGroup(layout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                    .addComponent(labelServicio)
                    .addComponent(comboServicio)
                )
                .addComponent(labelTiempo)  // Añadimos el cronómetro
                .addComponent(btnProcesar)
                .addComponent(btnIniciarProceso)
                .addComponent(new JScrollPane(listaEnProceso)) // Añadimos la JList
                .addComponent(areaResultado)
        );
// Acción del botón "Agregar a Cola"
        btnProcesar.addActionListener(e -> {
            String cedula = fieldCedula.getText();
            String categoria = comboCategoria.getSelectedItem().toString();
            String servicio = comboServicio.getSelectedItem().toString();
            String tiempoConsulta = tiempoActual.format(DateTimeFormatter.ofPattern("HH:mm:ss"));

            // Agregar el resultado a la cola
            String resultado = "Cédula: " + cedula + ", Categoría: " + categoria + ", Servicio: " + servicio + ", Hora: " + tiempoConsulta;
            colaResultados.offer(resultado); // Agregar a la cola

            // Mostrar en el área de resultado
            areaResultado.setText("Resultado agregado a la cola:\n" + resultado);
        });

        // Acción del botón "Iniciar Procesamiento"
        btnIniciarProceso.addActionListener(e -> {
            // Procesar los elementos en la cola cada 5 segundos
            new Timer(5000, new ActionListener() {
                @Override
                public void actionPerformed(ActionEvent e) {
                    if (!colaResultados.isEmpty()) {
                        String resultadoEnProceso = colaResultados.poll(); // Extraer de la cola
                        modeloEnProceso.addElement(resultadoEnProceso); // Agregar a la lista en proceso
                    } else {
                        ((Timer) e.getSource()).stop(); // Detener el Timer si la cola está vacía
                    }
                }
            }).start(); // Iniciar el timer de procesamiento
        });

        // Iniciar el timer de la hora
        iniciarCronometro();

        // Ajustar el tamaño y mostrar la ventana
        pack();
        setVisible(true);
    }

    // Método para iniciar el cronómetro
    private void iniciarCronometro() {
        timer = new Timer(1000, new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                // Actualizamos el tiempo actual cada segundo
                tiempoActual = LocalTime.now();
                labelTiempo.setText("Hora Actual: " + tiempoActual.format(DateTimeFormatter.ofPattern("HH:mm:ss")));
            }
        });
        timer.start();  // Iniciar el Timer
    }

    // Método principal para correr la aplicación
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(() -> new EPS().setVisible(true));
    }
}
